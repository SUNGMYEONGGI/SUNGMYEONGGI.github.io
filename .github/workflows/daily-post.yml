name: Daily Workflow Post

on:
  schedule:
    - cron: "0 23 * * *" # ë§¤ì¼ ì˜¤ì „ 8ì‹œ KST (23:00 UTC)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  create-daily-workflow-post:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up current date
        id: date
        run: |
          echo "DATE=$(date +'%Y-%m-%d')" >> $GITHUB_ENV
          echo "FULLYEAR=$(date +'%Y')" >> $GITHUB_ENV
          echo "YYMMDD=$(date +'%y%m%d')" >> $GITHUB_ENV
          echo "CURRENT_TIME=$(date +'%H:%M:%S')" >> $GITHUB_ENV

      - name: Create daily workflow post
        run: |
          mkdir -p _posts/ë°ì¼ë¦¬/ì›Œí¬í”Œë¡œìš°
          POST_FILE="_posts/ë°ì¼ë¦¬/ì›Œí¬í”Œë¡œìš°/${DATE}-${YYMMDD}-workflow.md"
          TEMPLATE_FILE="_posts/ë°ì¼ë¦¬/ì›Œí¬í”Œë¡œìš°/template.md"
          if [ -f "$TEMPLATE_FILE" ]; then
            cp "$TEMPLATE_FILE" "$POST_FILE"
            sed -i "s/FULLYEAR-MM-DD/${DATE}/g" "$POST_FILE"
            sed -i "s/CURRENT_TIME/${CURRENT_TIME}/g" "$POST_FILE"
            sed -i "s/YYMMDD/${YYMMDD}/g" "$POST_FILE"
            sed -i "s/title: ìë™í™” ê¸€.*/title: ìë™í™” ê¸€ ${DATE}/g" "$POST_FILE"
            sed -i "s/alt: ìë™í™” ê¸€ ì´ë¯¸ì§€/alt: ìë™í™” ê¸€ ${DATE} ì´ë¯¸ì§€/g" "$POST_FILE"
          else
            echo "---" > "$POST_FILE"
            echo "title: ìë™í™” ê¸€ ${DATE}" >> "$POST_FILE"
            echo "description: ìë™í™” ê¸€" >> "$POST_FILE"
            echo "date: ${DATE} ${CURRENT_TIME} +0900" >> "$POST_FILE"
            echo "last_modified_at: ${DATE} ${CURRENT_TIME} +0900" >> "$POST_FILE"
            echo "categories: [ ë°ì¼ë¦¬, ì›Œí¬í”Œë¡œìš° ]" >> "$POST_FILE"
            echo "tags: [ ìë™í™”, ë°ì¼ë¦¬ ]" >> "$POST_FILE"
            echo "image:" >> "$POST_FILE"
            echo "  path: 'https://heuristing.net/attachment/1/Blog-graphic-from-Istock.jpg'" >> "$POST_FILE"
            echo "  alt: 'ìë™í™” ê¸€ ${DATE} ì´ë¯¸ì§€'" >> "$POST_FILE"
            echo "---" >> "$POST_FILE"
            echo "" >> "$POST_FILE"
            echo "# ${DATE} ì›Œí¬í”Œë¡œìš° ìë™ ìƒì„± ê¸€" >> "$POST_FILE"
            echo "" >> "$POST_FILE"
            echo "***" >> "$POST_FILE"
            echo "    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° " >> "$POST_FILE"
            echo "    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„" >> "$POST_FILE"
            echo "" >> "$POST_FILE"
            echo "<a href=\"#\" style=\"display: inline-block; padding: 5px 10px; color: #007bff; text-decoration: none; border: 0.5px solid #007bff; border-radius: 5px; float: right;\">ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°</a>" >> "$POST_FILE"
          fi

      - name: Commit and push if changed
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git add _posts/ë°ì¼ë¦¬/ì›Œí¬í”Œë¡œìš°/
          git commit -m "Daily workflow post for ${DATE}" || exit 0
          git push
